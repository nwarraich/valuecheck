<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analyze Listing | ValueCheck</title>
  <style>
    body { font-family: sans-serif; background: #f5f8ff; padding: 2rem; max-width: 800px; margin: 0 auto; }
    textarea { width: 100%; height: 200px; margin-bottom: 1rem; padding: 0.5rem; font-family: monospace; }
    button { padding: 0.75rem 1.5rem; background: #1e3a8a; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    #result { margin-top: 1.5rem; padding: 1.5rem; background: #e0ecff; border-radius: 8px; border-left: 4px solid #1e3a8a; }
    .error { background: #fee2e2; border-left-color: #dc2626; color: #991b1b; }
    .loading { color: #1e3a8a; font-style: italic; }
    .verdict { font-weight: bold; color: #1e3a8a; font-size: 1.1rem; }
    .note { background: #fef3c7; padding: 1rem; margin-top: 1rem; border-radius: 5px; font-size: 0.9rem; }
  </style>
</head>
<body>

<h1>ValueCheck - Real Estate Analyzer</h1>

<div class="note">
  <strong>How to use:</strong>
  <ul>
    <li>Paste the full property listing text directly (NOT just a URL)</li>
    <li>Include details like: address, price, square footage, beds, baths, description</li>
    <li>The AI will analyze if it's underpriced, fairly priced, or overpriced</li>
  </ul>
</div>

<textarea id="listing" placeholder="Paste your complete property listing text here... (e.g., 'Beautiful 3-bed home in Downtown, 1500 sq ft, listed at $450,000, built in 1995...')"></textarea>
<br>
<button id="analyzeBtn" onclick="analyze()">Analyze Listing</button>

<div id="result" style="display:none;"></div>

<script>
async function analyze() {
  const listing = document.getElementById("listing").value.trim();
  const btn = document.getElementById("analyzeBtn");

  if (!listing) {
    alert("Please paste a property listing!");
    return;
  }

  if (listing.length < 50) {
    alert("Please provide more details about the property (at least 50 characters)");
    return;
  }

  try {
    btn.disabled = true;
    btn.textContent = "Analyzing...";

    const response = await fetch("http://127.0.0.1:8001/analyze", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ listing_text: listing })
    });

    if (!response.ok) {
      throw new Error(`Server error: ${response.statusText}`);
    }

    const data = await response.json();

    const resultDiv = document.getElementById("result");
    resultDiv.style.display = "block";
    
    // Check if this is an error response from backend
    if (data.verdict === "Error" || data.explanation.includes("not configured")) {
      resultDiv.classList.add("error");
      resultDiv.innerHTML = `<strong>⚠️ Error:</strong> ${data.explanation}`;
    } else {
      resultDiv.classList.remove("error");
      resultDiv.innerHTML = `
        <div class="verdict">Verdict: ${data.verdict}</div>
        <br>
        <strong>Estimated Price Range:</strong> ${data.estimated_range} <br><br>
        <strong>Analysis:</strong> ${data.explanation}
      `;
    }
  } catch (err) {
    const resultDiv = document.getElementById("result");
    resultDiv.style.display = "block";
    resultDiv.classList.add("error");
    resultDiv.innerHTML = `<strong>❌ Error:</strong> ${err.message}<br><br>Make sure the backend is running on http://localhost:8001`;
    console.error(err);
  } finally {
    btn.disabled = false;
    btn.textContent = "Analyze Listing";
  }
}

// Allow Enter key to submit
document.getElementById("listing").addEventListener("keydown", function(e) {
  if (e.ctrlKey && e.key === "Enter") analyze();
});
</script>

</body>
</html>
